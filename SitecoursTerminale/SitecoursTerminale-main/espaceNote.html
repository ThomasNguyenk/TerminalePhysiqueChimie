<!DOCTYPE html>
<html lang="fr">

<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="icon" type="image/png" href="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRQphyk9ejUn8W2sQ9h9tofy5rNyUdzq-5HSA&s">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<title>Espace Notes & Cartographie Cognitive</title>

<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
:root {
  --neon-blue: #00bcd4;
  --neon-purple: #9c27b0;
  --dark-bg: #121218;
  --card-bg: #1e1e24;
  --text-light: #e0e0e0;
  --success-color: #4CAF50;
  --error-color: #FF5252;
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
  font-family: 'Poppins', sans-serif;
}

body {
  margin: 0;
  color: var(--text-light);
  padding-top: 80px; 
  background: url('https://png.pngtree.com/thumb_back/fh260/background/20241001/pngtree-innovative-communication-tech-concept-of-a-globally-connected-world-cloud-computing-image_16282681.jpg') center/cover fixed;
  background-color: var(--dark-bg);
  min-height: 100vh;
}

.header-nav {
  display: flex;
  justify-content: center;
  align-items: center;
  background: rgba(10, 10, 20, 0.92);
  padding: 1.2rem 2rem;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  z-index: 1000;
  box-shadow: 0 0 20px rgba(0, 188, 212, 0.5),
              0 0 40px rgba(0, 188, 212, 0.3);
  backdrop-filter: blur(10px);
  border-bottom: 2px solid var(--neon-blue);
}

.logo {
  font-weight: 800;
  font-size: 1.8rem;
  color: var(--neon-blue);
  text-decoration: none;
  text-shadow: 0 0 10px var(--neon-blue),
               0 0 20px var(--neon-blue);
  position: absolute;
  left: 2rem;
  letter-spacing: 1.5px;
}

.menu-links {
  display: flex;
  gap: 1.2rem;
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
}

.menu-links a {
  color: #d8faff;
  font-size: 1.05rem;
  text-decoration: none;
  padding: 0.6rem 1.2rem;
  border-radius: 8px;
  font-weight: 600;
  letter-spacing: 0.5px;
  transition: 0.25s;
  border: 1px solid rgba(0, 188, 212, 0.25);
  background: rgba(0, 188, 212, 0.05);
  backdrop-filter: blur(4px);
}

.menu-links a:hover {
  background: rgba(0, 188, 212, 0.25);
  color: #ffffff;
  border: 1px solid var(--neon-blue);
  box-shadow: 0 0 10px rgba(0, 188, 212, 0.8),
              0 0 20px rgba(0, 188, 212, 0.4);
  transform: translateY(-2px);
}

.menu-links a.active {
  background: rgba(0, 188, 212, 0.4);
  color: #ffffff;
  border: 1px solid var(--neon-blue);
  box-shadow: 0 0 12px rgba(0, 188, 212, 1),
              0 0 25px rgba(0, 188, 212, 0.6);
}

main {
  max-width: 1200px;
  margin: 2rem auto;
  display: flex;
  flex-wrap: wrap;
  gap: 2rem;
  padding: 0 1rem;
}

.note-section, .mindmap-section {
  flex: 1 1 550px;
  background: var(--card-bg);
  padding: 1.5rem;
  border-radius: 12px;
  box-shadow: 0 0 20px rgba(0, 188, 212, 0.1);
  border: 1px solid rgba(0, 188, 212, 0.3);
}

.note-section h2, .mindmap-section h2 {
  margin-bottom: 1rem;
  color: var(--neon-blue);
  text-shadow: 0 0 5px rgba(0, 188, 212, 0.5);
  border-bottom: 1px dashed rgba(0, 188, 212, 0.3);
  padding-bottom: 0.5rem;
}

.note-section input,
.note-section textarea,
select,
input[type=color] {
  width: 100%;
  padding: 0.8rem 1rem;
  margin-bottom: 1rem;
  border-radius: 8px;
  border: 1px solid var(--neon-blue);
  background: #0d0d10;
  color: var(--text-light);
  transition: 0.3s;
}

.note-section textarea {
  min-height: 120px;
  resize: vertical;
}

button {
  cursor: pointer;
  padding: 0.6rem 1.2rem;
  border: none;
  border-radius: 6px;
  font-weight: 600;
  margin-right: 0.5rem;
  transition: all 0.3s;
  letter-spacing: 0.5px;
}

.add-btn { background: var(--neon-blue); color: var(--dark-bg); }
.add-btn:hover { background: #00a4bd; transform: translateY(-2px); box-shadow: 0 0 10px var(--neon-blue); }

.generate-btn { background: var(--neon-purple); color: #fff; }
.generate-btn:hover { background: #8b23a0; transform: translateY(-2px); }

.pdf-btn { background: var(--success-color); color: #fff; }
.pdf-btn:hover { background: #3e8f41; transform: translateY(-2px); }

.clear-btn { background: var(--error-color); color: #fff; }
.clear-btn:hover { background: #d64545; transform: translateY(-2px); }

#notesContainer {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  margin-top: 1rem;
}

.note {
  background: rgba(0, 188, 212, 0.1);
  padding: 0.8rem 1rem;
  border-left: 3px solid var(--neon-blue);
  border-radius: 6px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.delete-note {
  background: transparent;
  color: var(--error-color);
  border: none;
  cursor: pointer;
}

canvas {
  width: 100%;
  background: #101015;
  border: 2px solid var(--neon-blue);
  border-radius: 12px;
}

@media (max-width: 768px) {
  .header-nav { flex-direction: column; padding: 1rem; height: auto; }
  .logo { position: static; margin-bottom: 10px; }
  .menu-links { position: static; transform: none; flex-wrap: wrap; justify-content: center; }
  body { padding-top: 130px; }
}
</style>
</head>

<body>
<div id="app">

<header class="header-nav">
  <a href="espaceNote.html" class="logo">Espace Notes</a>
  <nav class="menu-links">
    <a href="index.html">Accueil</a>
    <a href="Terminale.html">Cours</a>
    <a href="Quiz de r√©vision de Terminale.html">Quiz</a>
    <a href="espaceNote.html" class="active">Notes</a>
    <a href="AideAvecIA.html">IA</a>
    <a href="MiniD√©fi.html">D√©fis</a>
    <a href="AnnexeMotCl√©.html">Glossaire</a>
    <a href="Connexion √©tudiant.html">Profil</a>
  </nav>
</header>

<main>
  <div class="note-section">
    <h2>üìù Data Input Log</h2>
    <input type="text" v-model="theme" placeholder="Th√®me principal">
    <textarea v-model="noteInput" @keydown.enter.prevent="addNoteEnter" placeholder="Saisir la donn√©e / note ici..."></textarea>

    <div style="display:flex; flex-wrap:wrap; gap:0.8rem; margin-bottom: 1rem;">
      <button class="add-btn" @click="addNote">‚ûï Ajouter</button>
      <button class="generate-btn" @click="generateMindmap">‚ö° G√©n√©rer Carte</button>
      <button class="pdf-btn" @click="downloadPDF">‚¨áÔ∏è PDF</button>
    </div>

    <div id="notesContainer">
      <div class="note" v-for="(n,i) in notes" :key="i">
        <span>{{ n }}</span>
        <button class="delete-note" @click="deleteNote(i)">[DEL]</button>
      </div>
    </div>
  </div>

  <div class="mindmap-section">
    <h2>üß† Cartographie Cognitive</h2>
    <div class="tools">
      <select v-model="bubbleShape">
        <option value="circle">Cercle</option>
        <option value="rectangle">Rectangle</option>
        <option value="rounded">Capsule</option>
      </select>
      <input type="color" v-model="bubbleColor">
      <button class="clear-btn" @click="clearMindmap">üóëÔ∏è Effacer</button>
    </div>
    <canvas id="mindmapCanvas" width="600" height="500"></canvas>
  </div>
</main>
</div>

<script>
const { createApp, ref, onMounted, watch } = Vue;

createApp({
  setup() {
    const theme = ref(localStorage.getItem("theme") || "");
    const noteInput = ref("");
    const notes = ref(JSON.parse(localStorage.getItem("notes") || "[]"));
    const bubbleShape = ref(localStorage.getItem("bubbleShape") || "circle");
    const bubbleColor = ref(localStorage.getItem("bubbleColor") || "#00bcd4");

    let canvas, ctx;
    let bubbles = [];
    let connections = [];
    let centerBubble = null;
    let dragTarget = null;
    let isDragging = false;
    let offsetX, offsetY;

    function addNote() {
      if (!noteInput.value.trim()) return;
      notes.value.push(noteInput.value.trim());
      noteInput.value = "";
      saveSettings();
    }

    function addNoteEnter(e) {
      if (!e.shiftKey) addNote();
      else noteInput.value += "\n";
    }

    function deleteNote(i) {
      notes.value.splice(i, 1);
      saveSettings();
    }

    function saveSettings() {
      localStorage.setItem("notes", JSON.stringify(notes.value));
      localStorage.setItem("theme", theme.value);
      localStorage.setItem("bubbleShape", bubbleShape.value);
      localStorage.setItem("bubbleColor", bubbleColor.value);
    }

    watch([theme, notes, bubbleShape, bubbleColor], saveSettings, { deep: true });

    function draw() {
      if (!ctx) return;
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      ctx.strokeStyle = "rgba(0, 188, 212, 0.4)";
      ctx.lineWidth = 2;

      connections.forEach(c => {
        ctx.beginPath();
        ctx.moveTo(c.a.x, c.a.y);
        ctx.lineTo(c.b.x, c.b.y);
        ctx.stroke();
      });

      const darkBg = getComputedStyle(document.documentElement).getPropertyValue('--dark-bg').trim();

      bubbles.forEach(b => {
        ctx.shadowColor = b.color;
        ctx.shadowBlur = b.text === (theme.value || "Th√®me") ? 20 : 10;
        ctx.fillStyle = b.color;

        ctx.beginPath();
        if (b.shape === "circle") {
          ctx.arc(b.x, b.y, 45, 0, Math.PI * 2);
        } else if (b.shape === "rectangle") {
          ctx.rect(b.x - 45, b.y - 25, 90, 50);
        } else {
          ctx.moveTo(b.x - 40, b.y - 25);
          ctx.lineTo(b.x + 40, b.y - 25);
          ctx.arcTo(b.x + 45, b.y - 25, b.x + 45, b.y, 10);
          ctx.arcTo(b.x + 45, b.y + 25, b.x + 40, b.y + 25, 10);
          ctx.lineTo(b.x - 40, b.y + 25);
          ctx.arcTo(b.x - 45, b.y + 25, b.x - 45, b.y, 10);
          ctx.arcTo(b.x - 45, b.y - 25, b.x - 40, b.y - 25, 10);
        }
        ctx.fill();

        ctx.shadowBlur = 0;
        ctx.fillStyle = b.text === (theme.value || "Th√®me") ? darkBg : "#fff";
        ctx.font = "500 13px Poppins";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";

        const words = b.text.split(" ");
        const lines = [];
        let temp = "";

        words.forEach(w => {
          if ((temp + w).length > 15) {
            lines.push(temp);
            temp = w + " ";
          } else {
            temp += w + " ";
          }
        });
        lines.push(temp);

        lines.forEach((line, i) =>
          ctx.fillText(line.trim(), b.x, b.y - ((lines.length - 1) * 14) / 2 + i * 14)
        );
      });
    }

    function generateMindmap() {
      if (!notes.value.length && !theme.value)
        return alert("Ajoutez un th√®me ou des notes.");

      clearMindmap();

      const cx = canvas.width / 2;
      const cy = canvas.height / 2;

      centerBubble = {
        text: theme.value || "Th√®me Principal",
        x: cx,
        y: cy,
        shape: "circle",
        color: "#f39c12",
        isCenter: true
      };
      bubbles.push(centerBubble);

      const radius = 180;
      notes.value.forEach((txt, i) => {
        const angle = (i / notes.value.length) * Math.PI * 2;
        const x = cx + radius * Math.cos(angle);
        const y = cy + radius * Math.sin(angle);
        const b = { text: txt, x, y, shape: bubbleShape.value, color: bubbleColor.value };
        bubbles.push(b);
        connections.push({ a: centerBubble, b });
      });

      draw();
    }

    function clearMindmap() {
      bubbles = [];
      connections = [];
      draw();
    }

    async function downloadPDF() {
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF({ orientation: "landscape" });
      const pdfWidth = pdf.internal.pageSize.getWidth();
      const pdfHeight = pdf.internal.pageSize.getHeight();

      const backgroundImg = new Image();
      backgroundImg.src = "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTCDnIqpFVcDaS52a7SPfSVRvEc6tNG9Zl4vA&s";
      backgroundImg.crossOrigin = "anonymous";

      backgroundImg.onload = () => {
        pdf.addImage(backgroundImg, 'JPEG', 0, 0, pdfWidth, pdfHeight);

        const canvasEl = document.getElementById("mindmapCanvas");
        const imgData = canvasEl.toDataURL("image/png");

        pdf.addImage(imgData, 'PNG', 10, 10, pdfWidth - 20, pdfHeight - 70);

        pdf.setFontSize(14);
        pdf.setTextColor(0,0,0);
        pdf.text("Notes :", 10, pdfHeight - 50);

        notes.value.forEach((n,i) => {
          pdf.text(`${i+1}. ${n}`, 10, pdfHeight - 35 + i*7);
        });

        pdf.save("CartographieCognitive.pdf");
      };

      backgroundImg.onerror = () => {
        alert("Impossible de charger l'image de fond !");
      };
    }

    function initCanvas() {
      canvas = document.getElementById("mindmapCanvas");
      ctx = canvas.getContext("2d");

      canvas.addEventListener("mousedown", e => {
        const rect = canvas.getBoundingClientRect();
        const mx = e.clientX - rect.left;
        const my = e.clientY - rect.top;
        dragTarget = bubbles.find(b => Math.hypot(mx - b.x, my - b.y) < 50);
        if (dragTarget) {
          isDragging = true;
          offsetX = mx - dragTarget.x;
          offsetY = my - dragTarget.y;
        }
      });

      canvas.addEventListener("mousemove", e => {
        if (!isDragging || !dragTarget) return;
        const rect = canvas.getBoundingClientRect();
        dragTarget.x = e.clientX - rect.left - offsetX;
        dragTarget.y = e.clientY - rect.top - offsetY;
        draw();
      });

      canvas.addEventListener("mouseup", () => {
        isDragging = false;
        dragTarget = null;
      });

      canvas.addEventListener("mouseleave", () => {
        isDragging = false;
        dragTarget = null;
      });

      const resizeCanvas = () => {
        const width = canvas.parentElement.clientWidth;
        canvas.width = width;
        canvas.height = Math.min(width * 0.7, 600);
        draw();
      };

      window.addEventListener("resize", resizeCanvas);
      resizeCanvas();
    }

    onMounted(initCanvas);

    return {
      theme,
      noteInput,
      notes,
      addNote,
      deleteNote,
      addNoteEnter,
      bubbleShape,
      bubbleColor,
      generateMindmap,
      clearMindmap,
      downloadPDF
    };
  }
}).mount("#app");
</script>

</body>
</html>
